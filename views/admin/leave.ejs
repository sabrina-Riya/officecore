<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Leaves</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 30px; }
  h2 { color: #333; }

  table { width:100%; border-collapse: collapse; background:#fff; margin-top:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  th, td { padding:8px; border:1px solid #ccc; text-align:center; }
  th { background:#007bff; color:#fff; }

  button { padding:4px 8px; margin:2px; cursor:pointer; border:none; border-radius:4px; }
  .approve { background:#28a745; color:#fff; }
  .reject { background:#dc3545; color:#fff; }
  input.reject-reason { width: 120px; padding: 3px; }

  .success { color: green; margin-bottom:10px; }
  .error { color: red; margin-bottom:10px; }
</style>
</head>
<body>

<h2>All Leave Requests</h2>

<!-- Flash Messages -->
<% if (success_msg && success_msg.length) { %>
  <div class="success"><%= success_msg %></div>
<% } %>
<% if (err_msg && err_msg.length) { %>
  <div class="error"><%= err_msg %></div>
<% } %>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Employee</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Reason</th>
      <th>Status</th>
      <th>Rejection Reason</th>
      <th>Actioned By</th> <!-- NEW COLUMN -->
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% if (leaves && leaves.length > 0) { %>
      <% leaves.forEach(l => { %>
        <tr>
          <td><%= l.id %></td>
          <td><%= l.employee_name %></td>
          <td><%= new Date(l.start_date).toISOString().split('T')[0] %></td>
          <td><%= new Date(l.end_date).toISOString().split('T')[0] %></td>
          <td><%= l.reason %></td>
          <td><%= l.status %></td>
          <td><%= l.rejection_reason || '-' %></td>
          <td><%= l.actioned_by || '-' %></td> <!-- SHOW ADMIN -->
          <td>
            <% if (l.status === "pending") { %>
              <!-- Approve Form -->
              <form action="/admin/leave/approve/<%= l.id %>" method="POST" style="display:inline;">
                <button class="approve" type="submit">Approve</button>
              </form>

              <!-- Reject Form -->
              <form action="/admin/leave/reject/<%= l.id %>" method="POST" style="display:inline;">
                <input type="text" name="reason" class="reject-reason" placeholder="Reason" required>
                <button class="reject" type="submit">Reject</button>
              </form>
            <% } %>
          </td>
        </tr>
      <% }) %>
    <% } else { %>
      <tr><td colspan="9">No leave requests found</td></tr>
    <% } %>
  </tbody>
</table>

<br>
<a href="/admin/dashboard">â¬… Back to Dashboard</a>
<a href="/logout">Logout</a>

</body>
</html>
